@{
    ViewData["Title"] = "Consulta 22 - Multas Pendientes";
}

<div class="container mt-4">
    <h2>💸 Consulta #22: Casas con Multas Pendientes de Pago</h2>
    <p class="text-muted">Listado de multas no pagadas</p>

    @if (ViewBag.MultasPendientes != null && ViewBag.MultasPendientes.Count > 0)
    {
        <div class="alert alert-warning">
            <strong>⚠️ Atención:</strong> Hay @ViewBag.MultasPendientes.Count multas pendientes de pago.
        </div>

        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-warning">
                    <tr>
                        <th>ID Multa</th>
                        <th>Ubicación</th>
                        <th>Concepto</th>
                        <th>Monto</th>
                        <th>Fecha</th>
                        <th>Días Pendiente</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var multa in ViewBag.MultasPendientes)
                    {
                        var diasPendiente = (DateTime.Now - multa.Fecha).Days;
                        <tr class="@(diasPendiente > 30 ? "table-danger" : diasPendiente > 15 ? "table-warning" : "")">
                            <td>@multa.IdMulta</td>
                            <td>
                                <strong>@multa.Cluster</strong><br />
                                <span class="badge bg-primary">Casa #@multa.Casa</span>
                            </td>
                            <td>@multa.Concepto</td>
                            <td><strong class="text-danger">Q @multa.Monto.ToString("N2")</strong></td>
                            <td>@multa.Fecha.ToString("dd/MM/yyyy")</td>
                            <td>
                                <span class="badge @(diasPendiente > 30 ? "bg-danger" : diasPendiente > 15 ? "bg-warning text-dark" : "bg-info")">
                                    @diasPendiente días
                                </span>
                            </td>
                        </tr>
                    }
                </tbody>
                <tfoot class="table-light">
                    <tr>
                        <th colspan="3" class="text-end">Total Pendiente:</th>
                        <th colspan="3">
                            @{
                                decimal totalPendiente = 0;
                                foreach (var multa in ViewBag.MultasPendientes)
                                {
                                    totalPendiente += multa.Monto;
                                }
                            }
                            <h4 class="text-danger mb-0">Q @totalPendiente.ToString("N2")</h4>
                        </th>
                    </tr>
                </tfoot>
            </table>
        </div>
    }
    else
    {
        <div class="alert alert-success">
            <strong>✓ Excelente.</strong> No hay multas pendientes de pago.
        </div>
    }

    <div class="mt-3">
        <a asp-action="Index" class="btn btn-secondary">← Volver a Consultas</a>
    </div>
</div>
